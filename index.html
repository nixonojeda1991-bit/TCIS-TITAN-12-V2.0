<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITÁN B11 | COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #fbbf24;
            --bg-dark: #0a0a0a;
        }
        body {
            background-color: var(--bg-dark);
            color: #d1d5db;
            font-family: 'JetBrains Mono', monospace;
        }
        .glow-border {
            border: 1px solid rgba(251, 191, 36, 0.2);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.05);
        }
        .scanline {
            width: 100%;
            height: 100px;
            z-index: 10;
            background: linear-gradient(0deg, rgba(251, 191, 36, 0) 0%, rgba(251, 191, 36, 0.05) 50%, rgba(251, 191, 36, 0) 100%);
            position: absolute;
            animation: scan 4s linear infinite;
            pointer-events: none;
        }
        @keyframes scan {
            from { top: -100px; }
            to { top: 100%; }
        }
        input[type=range] {
            accent-color: var(--primary);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-hidden">
    <div class="scanline"></div>

    <!-- BARRA DE ESTADO SUPERIOR -->
    <nav class="p-4 border-b border-zinc-800 flex justify-between items-center bg-black/50 backdrop-blur-md z-20">
        <div class="flex items-center gap-4">
            <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
            <h1 class="text-xl font-bold tracking-tighter text-white">TITÁN <span class="text-yellow-500">B11</span></h1>
        </div>
        <div class="flex gap-4 items-center">
            <span class="text-[10px] text-zinc-500 hidden md:block uppercase tracking-widest">Estado: Operacional / Director Nixon</span>
            <a href="https://wa.me/573000000000" target="_blank" class="bg-green-600/10 border border-green-500/50 text-green-500 px-3 py-1 rounded text-[10px] hover:bg-green-600 hover:text-white transition-all">SOPORTE WHATSAPP</a>
        </div>
    </nav>

    <main class="flex-1 flex flex-col md:flex-row p-4 gap-4 overflow-hidden relative">
        
        <!-- PANEL DE CONTROL IZQUIERDO -->
        <aside class="w-full md:w-80 flex flex-col gap-4 overflow-y-auto pr-2 z-20">
            <!-- SLIDERS DE POTENCIA -->
            <div class="glow-border p-4 bg-zinc-900/50 rounded-lg">
                <label class="text-[10px] text-yellow-500 uppercase font-bold block mb-2">Intensidad del Núcleo</label>
                <input type="range" min="0" max="100" value="85" class="w-full h-1 bg-zinc-800 rounded-lg appearance-none cursor-pointer mb-4">
                
                <label class="text-[10px] text-yellow-500 uppercase font-bold block mb-2">Filtro de Soberanía</label>
                <input type="range" min="0" max="100" value="100" class="w-full h-1 bg-zinc-800 rounded-lg appearance-none cursor-pointer">
            </div>

            <!-- TERMINAL DE COMANDO -->
            <div class="glow-border p-4 bg-zinc-900/50 rounded-lg flex-1 min-h-[200px] flex flex-col">
                <h2 class="text-[10px] text-zinc-500 mb-2 font-bold uppercase tracking-widest">Inyectar Tesis</h2>
                <textarea id="promptInput" class="flex-1 bg-transparent border-none text-zinc-300 text-sm focus:ring-0 resize-none p-0 mono" placeholder="Esperando parámetros..."></textarea>
                <button id="runBtn" class="w-full bg-yellow-500 text-black font-black py-3 mt-4 text-xs uppercase tracking-tighter hover:bg-yellow-400 transition-all rounded">EJECUTAR ANÁLISIS</button>
            </div>

            <!-- PAGOS PAYPAL -->
            <div class="glow-border p-4 bg-zinc-900/50 rounded-lg">
                <p class="text-[9px] text-zinc-500 uppercase mb-3 text-center">Licencia de Uso Profesional</p>
                <div id="paypal-container"></div>
            </div>
        </aside>

        <!-- PANTALLA TÁCTICA CENTRAL -->
        <section class="flex-1 glow-border rounded-lg bg-black/80 relative flex flex-col overflow-hidden">
            <div class="bg-zinc-900 px-4 py-2 border-b border-zinc-800 flex justify-between">
                <span class="text-[9px] text-zinc-500 uppercase">Stream de Datos en Tiempo Real</span>
                <span id="timestamp" class="text-[9px] text-yellow-500 mono"></span>
            </div>
            <div id="displayArea" class="flex-1 p-6 overflow-y-auto text-sm leading-relaxed text-zinc-400">
                <div class="opacity-30 flex flex-col items-center justify-center h-full">
                    <p class="text-xs uppercase tracking-[0.8em]">Sistema Listo para el Director</p>
                </div>
            </div>
            
            <!-- HISTORIAL RÁPIDO (FIRE) -->
            <div class="p-4 border-t border-zinc-900 bg-zinc-950">
                <h3 class="text-[9px] text-zinc-600 uppercase mb-2">Archivos en Nube</h3>
                <div id="historyList" class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                    <!-- Los datos se inyectarán aquí -->
                </div>
            </div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'titan-b11-legacy';
        const apiKey = ""; // Inyectada automáticamente

        let userSession = null;

        // AUTH & FIRE INIT
        const init = async () => {
            try {
                const cred = await signInAnonymously(auth);
                userSession = cred.user;
                loadHistory();
            } catch (e) { console.error("Auth Fail"); }
        };

        const loadHistory = () => {
            if (!userSession) return;
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'history'));
            onSnapshot(q, (snap) => {
                const container = document.getElementById('historyList');
                container.innerHTML = "";
                snap.forEach(doc => {
                    const data = doc.data();
                    const btn = document.createElement('button');
                    btn.className = "px-3 py-1 bg-zinc-900 border border-zinc-800 text-[10px] text-zinc-500 hover:border-yellow-500 whitespace-nowrap rounded";
                    btn.innerText = data.title;
                    btn.onclick = () => { document.getElementById('displayArea').innerHTML = data.content; };
                    container.appendChild(btn);
                });
            }, (e) => {});
        };

        // AI ENGINE
        window.runAnalysis = async () => {
            const prompt = document.getElementById('promptInput').value;
            const display = document.getElementById('displayArea');
            const btn = document.getElementById('runBtn');

            if (!prompt) return;
            
            btn.innerText = "PROCESANDO...";
            btn.disabled = true;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "Eres Titán B11. Responde con lenguaje técnico y autoritario. Usa Google Search para datos precisos." }] },
                        tools: [{ "google_search": {} }]
                    })
                });

                const data = await res.json();
                const content = data.candidates[0].content.parts[0].text;
                display.innerHTML = `<div class="animate-in fade-in duration-700">${content}</div>`;

                // SAVE TO FIRE
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'history'), {
                    title: prompt.substring(0, 15) + "...",
                    content: content,
                    timestamp: Date.now()
                });

            } catch (err) {
                display.innerHTML = `<p class="text-red-500">ERROR DE CONEXIÓN AL NÚCLEO</p>`;
            } finally {
                btn.innerText = "EJECUTAR ANÁLISIS";
                btn.disabled = false;
            }
        };

        document.getElementById('runBtn').addEventListener('click', runAnalysis);

        // PAYPAL INIT
        paypal.Buttons({
            createOrder: (data, actions) => actions.order.create({ purchase_units: [{ amount: { value: '10.00' } }] }),
            onApprove: (data, actions) => actions.order.capture().then(() => alert('PAGO APROBADO - LICENCIA ACTIVADA'))
        }).render('#paypal-container');

        // CLOCK
        setInterval(() => {
            document.getElementById('timestamp').innerText = new Date().toLocaleTimeString();
        }, 1000);

        init();
    </script>
</body>
</html>
